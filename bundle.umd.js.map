{"version":3,"file":"bundle.umd.js","sources":["index.js"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Rx = __importStar(require(\"rxjs\"));\nconst operators_1 = require(\"rxjs/operators\");\nconst graphql_1 = require(\"graphql\");\nconst graphql_tools_1 = require(\"graphql-tools\");\nconst apollo_link_1 = require(\"apollo-link\");\nconst TokenEnum_1 = require(\"./enums/TokenEnum\");\nconst iterall_1 = require(\"iterall\");\nconst isSubscription_1 = require(\"./utils/isSubscription\");\nconst ensureIterable_1 = require(\"./utils/ensureIterable\");\nconst schema_1 = require(\"./schema\");\nconst loaders = __importStar(require(\"./loaders\"));\nconst resolvers = __importStar(require(\"./resolvers\"));\n__export(require(\"./types\"));\nexports.createSchema = (environment) => {\n    const TokenEnum = TokenEnum_1.createTokenEnum(environment);\n    const executable = graphql_tools_1.makeExecutableSchema({\n        resolvers: Object.assign(Object.assign({}, resolvers), { TokenEnum }),\n        typeDefs: [TokenEnum_1.createTokenEnumDefinition(TokenEnum), schema_1.schema],\n        inheritResolversFromInterfaces: true,\n    });\n    return executable;\n};\nexports.createQueryContext = (environment) => {\n    return (operation) => __awaiter(void 0, void 0, void 0, function* () {\n        const current = yield environment.client.getBlockNumber();\n        const block = operation.variables.block || current;\n        // Wait until minimum block is reached.\n        yield new Promise((resolve, reject) => {\n            const block$ = Rx.of(block);\n            const polling$ = block$.pipe(operators_1.expand(() => Rx.timer(1000).pipe(operators_1.switchMap(() => environment.client.getBlockNumber()))));\n            const wait$ = polling$.pipe(operators_1.takeWhile((value) => value < block, true), operators_1.takeLast(1));\n            return wait$.subscribe({\n                next: (value) => resolve(value),\n                error: (error) => reject(error),\n            });\n        });\n        const context = {\n            block,\n            environment,\n            loaders: {},\n        };\n        Object.keys(loaders).forEach((key) => {\n            // @ts-ignore\n            context.loaders[key] = loaders[key](context);\n        });\n        return context;\n    });\n};\nexports.createSchemaLink = (options) => {\n    const handleRequest = (request, observer) => __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const context = yield options.context(request);\n            const args = {\n                schema: options.schema,\n                rootValue: options.root,\n                contextValue: context,\n                variableValues: request.variables,\n                operationName: request.operationName,\n                document: request.query,\n            };\n            const result = isSubscription_1.isSubscription(request.query) ? graphql_1.subscribe(args) : graphql_1.execute(args);\n            const iterable = ensureIterable_1.ensureIterable(yield result);\n            yield iterall_1.forAwaitEach(iterable, (value) => {\n                if (value.errors && value.errors.length) {\n                    observer.error(value.errors[0]);\n                }\n                else {\n                    observer.next(value);\n                }\n            });\n            observer.complete();\n        }\n        catch (error) {\n            observer.error(error);\n        }\n    });\n    const createObservable = (request) => {\n        return new apollo_link_1.Observable((observer) => {\n            handleRequest(request, observer);\n        });\n    };\n    return new apollo_link_1.ApolloLink((request) => createObservable(request));\n};\n"],"names":["this"],"mappings":"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"}