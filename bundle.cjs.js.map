{"version":3,"file":"bundle.cjs.js","sources":["bundle.esm.js"],"sourcesContent":["var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nvar __importStar = (undefined && undefined.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Rx = __importStar(require(\"rxjs\"));\nconst operators_1 = require(\"rxjs/operators\");\nconst graphql_1 = require(\"graphql\");\nconst graphql_tools_1 = require(\"graphql-tools\");\nconst apollo_link_1 = require(\"apollo-link\");\nconst TokenEnum_1 = require(\"./enums/TokenEnum\");\nconst iterall_1 = require(\"iterall\");\nconst isSubscription_1 = require(\"./utils/isSubscription\");\nconst ensureIterable_1 = require(\"./utils/ensureIterable\");\nconst schema_1 = require(\"./schema\");\nconst loaders = __importStar(require(\"./loaders\"));\nconst resolvers = __importStar(require(\"./resolvers\"));\n__export(require(\"./types\"));\nexports.createSchema = (environment) => {\n    const TokenEnum = TokenEnum_1.createTokenEnum(environment);\n    const executable = graphql_tools_1.makeExecutableSchema({\n        resolvers: Object.assign(Object.assign({}, resolvers), { TokenEnum }),\n        typeDefs: [TokenEnum_1.createTokenEnumDefinition(TokenEnum), schema_1.schema],\n        inheritResolversFromInterfaces: true,\n    });\n    return executable;\n};\nexports.createQueryContext = (environment) => {\n    return (operation) => __awaiter(void 0, void 0, void 0, function* () {\n        const current = yield environment.client.getBlockNumber();\n        const block = operation.variables.block || current;\n        // Wait until minimum block is reached.\n        yield new Promise((resolve, reject) => {\n            const block$ = Rx.of(block);\n            const polling$ = block$.pipe(operators_1.expand(() => Rx.timer(1000).pipe(operators_1.switchMap(() => environment.client.getBlockNumber()))));\n            const wait$ = polling$.pipe(operators_1.takeWhile((value) => value < block, true), operators_1.takeLast(1));\n            return wait$.subscribe({\n                next: (value) => resolve(value),\n                error: (error) => reject(error),\n            });\n        });\n        const context = {\n            block,\n            environment,\n            loaders: {},\n        };\n        Object.keys(loaders).forEach((key) => {\n            // @ts-ignore\n            context.loaders[key] = loaders[key](context);\n        });\n        return context;\n    });\n};\nexports.createSchemaLink = (options) => {\n    const handleRequest = (request, observer) => __awaiter(void 0, void 0, void 0, function* () {\n        try {\n            const context = yield options.context(request);\n            const args = {\n                schema: options.schema,\n                rootValue: options.root,\n                contextValue: context,\n                variableValues: request.variables,\n                operationName: request.operationName,\n                document: request.query,\n            };\n            const result = isSubscription_1.isSubscription(request.query) ? graphql_1.subscribe(args) : graphql_1.execute(args);\n            const iterable = ensureIterable_1.ensureIterable(yield result);\n            yield iterall_1.forAwaitEach(iterable, (value) => {\n                if (value.errors && value.errors.length) {\n                    observer.error(value.errors[0]);\n                }\n                else {\n                    observer.next(value);\n                }\n            });\n            observer.complete();\n        }\n        catch (error) {\n            observer.error(error);\n        }\n    });\n    const createObservable = (request) => {\n        return new apollo_link_1.Observable((observer) => {\n            handleRequest(request, observer);\n        });\n    };\n    return new apollo_link_1.ApolloLink((request) => createObservable(request));\n};\n//# sourceMappingURL=bundle.esm.js.map\n"],"names":[],"mappings":"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"}